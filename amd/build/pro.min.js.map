{"version":3,"file":"pro.min.js","sources":["../src/pro.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// jshint unused: true, undef:true\n\ndefine(['jquery', 'core/log', 'core/config'], function($, log, cfg) {\n\n    var localvfcorepro = {\n\n        component: 'local_vfcore',\n        shortcomponent: 'local_vfcore',\n        componentpath: 'local/vfcore',\n\n        init: function() {\n\n            var licensekeyid = '#id_s_' + localvfcorepro.shortcomponent + '_licensekey';\n            $(licensekeyid).bind('change', this.check_product_key);\n            $(licensekeyid).trigger('change');\n            log.debug('AMD Pro js initialized for ' + localvfcorepro.component + ' system');\n        },\n\n        check_product_key: function() {\n\n            var licensekeyid = '#id_s_' + localvfcorepro.shortcomponent + '_licensekey';\n\n            var that = $(this);\n\n            var productkey = that.val().replace(/-/g, '');\n            var payload = productkey.substr(0, 14);\n            var crc = productkey.substr(14, 2);\n\n            var calculated = localvfcorepro.checksum(payload);\n\n            var validicon = ' <img class=\"icon\" src=\"' + cfg.wwwroot + '/pix/i/valid.svg' + '\">';\n            var cautionicon = ' <img class=\"icon\" src=\"' + cfg.wwwroot + '/pix/i/warning.svg' + '\">';\n            var invalidicon = ' <img class=\"icon\" src=\"' + cfg.wwwroot + '/pix/i/invalid.svg' + '\">';\n            var waiticon = ' <img class=\"icon\" src=\"' + cfg.wwwroot + '/pix/i/loading.svg' + '\">';\n            var found;\n\n            if (crc === calculated) {\n                var url = cfg.wwwroot + '/' + localvfcorepro.componentpath + '/pro/ajax/services.php?';\n                url += 'what=license';\n                url += '&service=check';\n                url += '&customerkey=' + that.val();\n                url += '&provider=' + $('#id_s_' + localvfcorepro.shortcomponent + '_licenseprovider').val();\n\n                $(licensekeyid + ' + img').remove();\n                $(licensekeyid).after(waiticon);\n\n                $.get(url, function(data) {\n                    if (data.match(/(SET|CHECK) OK/)) {\n                        if (found = data.match(/-\\d+.*$/)) {\n                            $(licensekeyid + ' + img').remove();\n                            $(licensekeyid).after(cautionicon);\n                        } else {\n                            $(licensekeyid + ' + img').remove();\n                            $(licensekeyid).after(validicon);\n                        }\n                    } else {\n                        $(licensekeyid + ' + img').remove();\n                        $(licensekeyid).after(invalidicon);\n                    }\n                }, 'html');\n            } else {\n                $(licensekeyid + ' + img').remove();\n                $(licensekeyid).after(cautionicon);\n            }\n        },\n\n        /**\n         * Calculates a checksum on 2 chars.\n         * @param {string} keypayload\n         */\n        checksum: function(keypayload) {\n\n            var crcrange = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n            var crcrangearr = crcrange.split('');\n            var crccount = crcrangearr.length;\n            var chars = keypayload.split('');\n            var crc = 0;\n\n            for (var ch in chars) {\n                var ord = chars[ch].charCodeAt(0);\n                crc += ord;\n            }\n\n            var crc2 = Math.floor(crc / crccount) % crccount;\n            var crc1 = crc % crccount;\n            return '' + crcrangearr[crc1] + crcrangearr[crc2];\n        }\n    };\n\n    return localvfcorepro;\n});"],"names":["define","$","log","cfg","localvfcorepro","component","shortcomponent","componentpath","init","licensekeyid","bind","this","check_product_key","trigger","debug","that","productkey","val","replace","payload","substr","crc","calculated","checksum","validicon","wwwroot","cautionicon","invalidicon","waiticon","url","remove","after","get","data","match","keypayload","crcrangearr","split","crccount","length","chars","ch","charCodeAt","crc2","Math","floor"],"mappings":"AAiBAA,OAAO,mBAAA,CAAC,SAAU,WAAY,eAAgB,SAASC,EAAGC,IAAKC,KAE3D,IAAIC,eAAiB,CAEjBC,UAAW,eACXC,eAAgB,eAChBC,cAAe,eAEfC,KAAM,WAEF,IAAIC,aAAe,SAAWL,eAAeE,eAAiB,cAC9DL,EAAEQ,cAAcC,KAAK,SAAUC,KAAKC,mBACpCX,EAAEQ,cAAcI,QAAQ,UACxBX,IAAIY,MAAM,8BAAgCV,eAAeC,UAAY,UACxE,EAEDO,kBAAmB,WAEf,IAAIH,aAAe,SAAWL,eAAeE,eAAiB,cAE1DS,KAAOd,EAAEU,MAETK,WAAaD,KAAKE,MAAMC,QAAQ,KAAM,IACtCC,QAAUH,WAAWI,OAAO,EAAG,IAC/BC,IAAML,WAAWI,OAAO,GAAI,GAE5BE,WAAalB,eAAemB,SAASJ,SAErCK,UAAY,2BAA6BrB,IAAIsB,QAAjC,qBACZC,YAAc,2BAA6BvB,IAAIsB,QAAjC,uBACdE,YAAc,2BAA6BxB,IAAIsB,QAAjC,uBACdG,SAAW,2BAA6BzB,IAAIsB,QAAjC,uBAGf,GAAIJ,MAAQC,WAAY,CACpB,IAAIO,IAAM1B,IAAIsB,QAAU,IAAMrB,eAAeG,cAAgB,0BAC7DsB,KAAO,eACPA,KAAO,iBACPA,KAAO,gBAAkBd,KAAKE,MAC9BY,KAAO,aAAe5B,EAAE,SAAWG,eAAeE,eAAiB,oBAAoBW,MAEvFhB,EAAEQ,aAAe,UAAUqB,SAC3B7B,EAAEQ,cAAcsB,MAAMH,UAEtB3B,EAAE+B,IAAIH,IAAK,SAASI,MACZA,KAAKC,MAAM,kBACCD,KAAKC,MAAM,YACnBjC,EAAEQ,aAAe,UAAUqB,SAC3B7B,EAAEQ,cAAcsB,MAAML,eAEtBzB,EAAEQ,aAAe,UAAUqB,SAC3B7B,EAAEQ,cAAcsB,MAAMP,aAG1BvB,EAAEQ,aAAe,UAAUqB,SAC3B7B,EAAEQ,cAAcsB,MAAMJ,aAE7B,EAAE,OACP,MACI1B,EAAEQ,aAAe,UAAUqB,SAC3B7B,EAAEQ,cAAcsB,MAAML,YAE7B,EAMDH,SAAU,SAASY,YAEf,IACIC,YADW,uCACYC,MAAM,IAC7BC,SAAWF,YAAYG,OACvBC,MAAQL,WAAWE,MAAM,IACzBhB,IAAM,EAEV,IAAK,IAAIoB,MAAMD,MAAO,CAElBnB,KADUmB,MAAMC,IAAIC,WAAW,EAEnC,CAEA,IAAIC,KAAOC,KAAKC,MAAMxB,IAAMiB,UAAYA,SAExC,MAAO,GAAKF,YADDf,IAAMiB,UACeF,YAAYO,KAChD,GAGJ,OAAOvC,cACX"}